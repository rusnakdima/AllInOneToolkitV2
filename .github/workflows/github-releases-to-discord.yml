name: GitHub Releases to Discord Forum
on:
  release:
    types: [published]

jobs:
  publish-tauri:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Discord Forum Post
        run: |
          # Create JSON payload safely
          cat > payload.json << 'EOF'
          {
            "name": "ðŸš€ All In One Toolkit V2 (Beta release ${{ github.event.release.tag_name }})",
            "auto_archive_duration": 4320,
            "message": {
              "content": `
                **ðŸš€ New Release Available!**

                ðŸ“¦ **Version:** ${{ github.event.release.tag_name }}
                ðŸ”— **Download:** ${{ github.event.release.html_url }}

                ðŸ“ **Release Notes:**
                Information about the changes is shown in the picture.

                ---

                **ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´**
                **ðŸš€ ÐÐ¾Ð²Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°!**

                ðŸ“¦ **Ð’ÐµÑ€ÑÐ¸Ñ:** ${{ github.event.release.tag_name }}
                ðŸ”— **Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ:** ${{ github.event.release.html_url }}

                ðŸ“ **ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ Ðº Ð²Ñ‹Ð¿ÑƒÑÐºÑƒ:**
                Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ… Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð° Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐµ.
              `
            }
          }
          EOF

          # Send the request
          curl -X POST "${{ secrets.WEBHOOK_URL }}" \
            -H "Authorization: Bot ${{ secrets.DISCORD_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data @payload.json \
            --fail \
            --show-error
