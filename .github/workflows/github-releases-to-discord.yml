name: GitHub Releases to Discord Forum
on:
  release:
    types: [published]

jobs:
  github-releases-to-discord-forum:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Discord Forum Post
        run: |
          # Create JSON payload safely
          cat > payload.json << 'EOF'
          {
            "thread_name": "🚀 All In One Toolkit V2 - Release ${{ github.event.release.tag_name }}",
            "content": "**Attention! New program update released!** 📢\n\n🔗 **Download:** [${{ github.event.release.tag_name }}](${{ github.event.release.html_url }})\n\n📝 **Release Notes:**\n```\n${{ github.event.release.body }}\n```\n\n---\n\n**Russian translation** 🇷🇺\n**Внимание! Вышло обновление программы!** 📢\n\n🔗 **Скачать:** [${{ github.event.release.tag_name }}](${{ github.event.release.html_url }})\n\n📝 **Примечания к выпуску:**\n```\n${{ github.event.release.body }}\n```",
            "username": "Release Bot",
            "avatar_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          }
          EOF

          # Send the request
          curl -X POST "${{ secrets.WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            --data @payload.json \
            --fail \
            --show-error

      # Alternative approach using discord-action (if it supports forums)
      - name: Alternative - Using Discord Action
        if: failure()
        uses: appleboy/discord-action@v1.0.0
        with:
          webhook: ${{ secrets.WEBHOOK_URL }}
          thread_name: "🚀 All In One Toolkit V2 - Release ${{ github.event.release.tag_name }}"
          message: |
            **🚀 New Release Available!** 

            📦 **Version:** ${{ github.event.release.tag_name }}
            🔗 **Download:** ${{ github.event.release.html_url }}

            📝 **Release Notes:**
            ${{ github.event.release.body }}

            ---

            **🇷🇺 Русский перевод**
            **🚀 Новая версия доступна!**

            📦 **Версия:** ${{ github.event.release.tag_name }}
            🔗 **Скачать:** ${{ github.event.release.html_url }}

            📝 **Примечания к выпуску:**
            ${{ github.event.release.body }}
