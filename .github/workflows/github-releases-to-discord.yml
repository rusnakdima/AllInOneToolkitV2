name: GitHub Releases to Discord Forum
on:
  release:
    types: [published]

jobs:
  publish-tauri:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Discord Forum Post
        run: |
          # Create JSON payload safely
          cat > payload.json << 'EOF'
          {
            "name": "🚀 All In One Toolkit V2 (Beta release ${{ github.event.release.tag_name }})",
            "auto_archive_duration": 4320,
            "message": {
              "content": `
                **🚀 New Release Available!**

                📦 **Version:** ${{ github.event.release.tag_name }}
                🔗 **Download:** ${{ github.event.release.html_url }}

                📝 **Release Notes:**
                Information about the changes is shown in the picture.

                ---

                **🇷🇺 Русский перевод**
                **🚀 Новая версия доступна!**

                📦 **Версия:** ${{ github.event.release.tag_name }}
                🔗 **Скачать:** ${{ github.event.release.html_url }}

                📝 **Примечания к выпуску:**
                Информация об изменениях изображена на картинке.
              `
            }
          }
          EOF

          # Send the request
          curl -X POST "${{ secrets.WEBHOOK_URL }}" \
            -H "Authorization: Bot ${{ secrets.DISCORD_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data @payload.json \
            --fail \
            --show-error
